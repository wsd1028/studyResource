<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="./vuejs/css/element.css" />
    <title>采集配置</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
      }
      div {
        box-sizing: border-box;
      }
      #main {
        padding: 20px;
      }
    </style>
  </head>

  <body>
    <div id="main">
      <el-dialog title="编辑" :visible.sync="updateVisible" width="40%" @close="updateNo('updateForm')">
        <el-form
          ref="updateForm"
          :rules="updateRules"
          :model="updateForm"
          label-width="100px"
        >
          <el-form-item label="所属节点" prop="node">
            <el-input v-model="updateForm.node"></el-input>
          </el-form-item>
          <el-form-item label="服务器IP" prop="IP">
            <el-input v-model="updateForm.IP"></el-input>
          </el-form-item>
          <el-form-item label="服务器名称" prop="name">
            <el-input v-model="updateForm.name"></el-input>
          </el-form-item>
          <el-form-item label="描述">
            <el-input
              type="textarea"
              rows="4"
              v-model="updateForm.address"
              resize="none"
            ></el-input>
          </el-form-item>
          <el-form-item>
            <el-button type="primary" @click="updateYes('updateForm')">确定</el-button>
            <el-button @click="updateNo('updateForm')">取消</el-button>
          </el-form-item>
        </el-form>
      </el-dialog>
      <!-- 条件 -->
      <header></header>
      <el-table :data="tableData" style="width: 100%" border>
        <el-table-column label="节点" width="180" prop="name">
        </el-table-column>
        <el-table-column label="网管服务器名称" width="180" prop="name">
        </el-table-column>
        <el-table-column label="网管服务器IP" width="180" prop="name">
        </el-table-column
        ><el-table-column label="创建时间" width="180" prop="IP">
        </el-table-column
        ><el-table-column label="配置站点" width="180" prop="name">
        </el-table-column>
        <el-table-column label="操作">
          <template slot-scope="scope">
            <el-button size="mini" @click="handleEdit(scope.$index, scope.row)"
              >编辑</el-button
            >
            <el-button
              size="mini"
              type="danger"
              @click="handleDelete(scope.$index, scope.row)"
              >删除</el-button
            >
          </template>
        </el-table-column>
      </el-table>
      <el-pagination
        @size-change="handleSizeChange"
        @current-change="handleIndexChange"
        :current-page.sync="pageIndex"
        :page-sizes="[5,10,15,20]"
        :page-size="pageSize"
        align="right"
        style="marginTop:20px"
        layout="total,sizes, prev, pager, next,jumper"
        :total="dataCount"
      ></el-pagination>
    </div>
    <script src="./vuejs/js/vue.js"></script>
    <script src="./vuejs/js/element.js"></script>
    <script>
      let checkIp = function(rule, value, callback) {
        if (!value) {
          callback();
        } else {
          if (
            /((25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))/.test(
              value
            )
          ) {
            callback();
          } else {
            callback(new Error("ip地址格式不正确"));
          }
        }
      };
      var v = new Vue({
        el: "#main",
        data: {
          //分页
          dataCount: 100,
          pageSize: 5,
          pageIndex: 1,

          updateVisible: false,
          updateForm: {},
          tableData: [
            {
              IP: "2016-05-02",
              name: "王小虎",
              address: "上海市普陀区金沙江路 1518 弄"
            },
            {
              IP: "2016-05-04",
              name: "王小虎",
              address: "上海市普陀区金沙江路 1517 弄"
            },
            {
              IP: "2016-05-01",
              name: "王小虎",
              address: "上海市普陀区金沙江路 1519 弄"
            },
            {
              IP: "2016-05-03",
              name: "王小虎",
              address: "上海市普陀区金沙江路 1516 弄"
            }
          ],
          updateRules: {
            node: [
              { required: true, message: "所选节点不能为空", trigger: "blur" }
            ],
            name: [
              { required: true, message: "服务器名称不能为空", trigger: "blur" }
            ],
            IP: [
              {
                required: true,
                message: "服务器IP不能为空",
                trigger: "blur"
              },
              { trigger: "blur", validator: checkIp }
            ]
          }
        },
        methods: {
          handleSizeChange: function(val) {
              this.pageSize=val;
          },
          handleIndexChange: function(val) {
            this.pageIndex=val;

          },

          handleEdit: function(index, row) {
            console.log(index, row);
            this.updateVisible = true;
            this.updateForm = JSON.parse(JSON.stringify(row));
          },
          updateYes: function(formName) {
            this.$refs[formName].resetFields();

          },
          updateNo: function(formName) {
            this.$refs[formName].resetFields();
            this.updateVisible = false;

          },
          handleDelete: function(index, row) {
            console.log(index, row);
            let that = this;
            that
              .$confirm("是否删除该采集点", "提示", {
                confirmButtonText: "确定",
                cancelButtonText: "取消",
                type: "warning"
              })
              .then(function() {
                that.$message({
                  duration: 2000,
                  showClose: true,
                  type: "success",
                  message: "删除成功"
                });
              })
              .catch(function() {
                that.$message({
                  duration: 2000,
                  showClose: true,
                  type: "info",
                  message: "已取消删除"
                });
              });
          },
          getCookie: function(cookieName) {
            let strCookie = document.cookie;
            let arrCookie = strCookie.split("; ");
            for (let i = 0; i < arrCookie.length; i++) {
              let arr = arrCookie[i].split("=");
              if (cookieName == arr[0]) {
                return arr[1];
              }
            }
            return "";
          }
        },
        mounted: function() {
          let that = this;
        }
      });
    </script>
  </body>
</html>
